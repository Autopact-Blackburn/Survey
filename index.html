<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Purchase Experience Survey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6fa;
      margin: 0;
      padding: 12px;
      color: #1d2634;
    }

    .container {
      max-width: 720px;
      margin: 18px auto;
      background: #ffffff;
      padding: 24px 22px 28px;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(15,23,42,0.10);
    }

    h1 {
      text-align: center;
      font-size: 22px;
      margin: 6px 0 8px;
      color: #111827;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    .progress-container {
      width: 100%;
      height: 10px;
      background: #dfe6ee;
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 22px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #005bea, #00c6fb);
      width: 0%;
      transition: width 0.35s ease;
    }

    .page { display: none; }
    .page.active { display: block; }

    .section-label {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .question-block {
      margin-bottom: 18px;
    }

    .question {
      display: block;
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #111827;
    }

    .option {
      margin: 5px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #374151;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      padding: 9px;
      border-radius: 8px;
      border: 1px solid #cbd3df;
      font-size: 14px;
      resize: vertical;
    }

    textarea:focus {
      outline: 2px solid #005bea33;
      outline-offset: 1px;
    }

    .btn-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 22px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 11px 22px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      font-weight: 600;
      transition: opacity 0.15s ease, transform 0.1s ease;
    }

    .btn:active {
      transform: translateY(1px);
      opacity: 0.75;
    }

    .btn-back {
      background: #e4e7ec;
      color: #111827;
    }

    .btn-next {
      background: #005bea;
      color: #ffffff;
    }

    .btn-submit {
      width: 100%;
      margin-top: 16px;
      background: #00b16a;
      color: #ffffff;
      padding: 13px;
    }

    .success-screen {
      text-align: center;
      padding: 28px 16px 6px;
      display: none;
    }

    .success-screen h2 {
      margin: 0 0 10px;
      font-size: 22px;
    }

    .success-screen p {
      font-size: 14px;
      color: #4b5563;
      margin-top: 0;
    }

    .toast {
      position: fixed;
      bottom: 22px;
      left: 50%;
      transform: translateX(-50%) translateY(12px);
      background: #111827;
      color: white;
      padding: 12px 16px;
      border-radius: 999px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease, transform 0.35s ease;
      font-size: 13px;
      max-width: 90%;
      text-align: center;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0px);
    }
  </style>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
  var supabase;

  (function initSupabase() {
    if (window.__supabaseClient) {
      supabase = window.__supabaseClient;
      return;
    }

    const SUPABASE_URL = "https://jfvqdpephdqzalkcnmdy.supabase.co";
    const SUPABASE_KEY = "sb_publishable_l1p7oa8Lrp8rMPD2xcTyHw_vL_bwk8X";

    supabase = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_KEY
    );

    window.__supabaseClient = supabase;
  })();
</script>


</head>

<body>

  <div id="toast" class="toast">
    Please answer all required questions before continuing.
  </div>

  <div class="container">
    <h1>Customer Purchase Experience Survey</h1>
    <div class="subtitle">
      Your feedback helps us shape the future car-buying experience.
    </div>

    <div class="progress-container">
      <div id="progressBar" class="progress-bar"></div>
    </div>

    <form id="surveyForm" novalidate>

      <!-- PAGE 1 -->
      <div class="page active" data-page="1">
        <div class="section-label">Section 1 · Purchase Experience</div>

        <div class="question-block">
          <span class="question">1. When did you purchase your vehicle from us?</span>
          <div class="option"><input type="radio" name="purchase_time" value="past_month" required>Within the past month</div>
          <div class="option"><input type="radio" name="purchase_time" value="1_3">1–3 months ago</div>
          <div class="option"><input type="radio" name="purchase_time" value="3_12">3–12 months ago</div>
          <div class="option"><input type="radio" name="purchase_time" value="over_year">Over a year ago</div>
        </div>

        <div class="question-block">
          <span class="question">2. How would you rate your overall sales experience?</span>
          <div class="option"><input type="radio" name="exp_rating" value="excellent" required>Excellent</div>
          <div class="option"><input type="radio" name="exp_rating" value="good">Good</div>
          <div class="option"><input type="radio" name="exp_rating" value="average">Average</div>
          <div class="option"><input type="radio" name="exp_rating" value="below_avg">Below average</div>
          <div class="option"><input type="radio" name="exp_rating" value="poor">Poor</div>
        </div>

        <div class="question-block">
          <span class="question">3. When you visited for your purchase, how quickly were you greeted or acknowledged?</span>
          <div class="option"><input type="radio" name="greet_time" value="1_min" required>Within 1 minute</div>
          <div class="option"><input type="radio" name="greet_time" value="1_5">1–5 minutes</div>
          <div class="option"><input type="radio" name="greet_time" value="5_10">5–10 minutes</div>
          <div class="option"><input type="radio" name="greet_time" value="10_plus">More than 10 minutes</div>
          <div class="option"><input type="radio" name="greet_time" value="never">I was never greeted</div>
        </div>

        <div class="question-block">
          <span class="question">4. What parts of your purchase experience felt smooth or easy?</span>
          <textarea name="smooth" required></textarea>
        </div>

        <div class="question-block">
          <span class="question">5. What parts felt slow, confusing, or frustrating?</span>
          <textarea name="frustrating" required></textarea>
        </div>

        <div class="question-block">
          <span class="question">6. Thinking about other dealerships you visited, what stood out to you – positively or negatively?</span>
          <textarea name="other_dealers" required></textarea>
        </div>

        <div class="btn-row">
          <span></span>
          <button type="button" class="btn btn-next" onclick="nextPage()">Next</button>
        </div>
      </div>

      <!-- PAGE 2 -->
      <div class="page" data-page="2">
        <div class="section-label">Section 2 · Consultant & Digital Experience</div>

        <div class="question-block">
          <span class="question">7. How comfortable did you feel with your sales consultant?</span>
          <div class="option"><input type="radio" name="comfort" value="very" required>Very comfortable</div>
          <div class="option"><input type="radio" name="comfort" value="somewhat">Somewhat comfortable</div>
          <div class="option"><input type="radio" name="comfort" value="neutral">Neutral</div>
          <div class="option"><input type="radio" name="comfort" value="dislike">Disliked</div>
          <div class="option"><input type="radio" name="comfort" value="na">N/A</div>
        </div>

        <div class="question-block">
          <span class="question">8. How much influence did the sales consultant have on your purchase decision?</span>

          <div class="option"><input type="radio" name="consultant_influence" value="none" required>No influence – I had already decided</div>
          <div class="option"><input type="radio" name="consultant_influence" value="small">Small influence – helped confirm my decision</div>
          <div class="option"><input type="radio" name="consultant_influence" value="moderate">Moderate influence – helped compare and clarify</div>
          <div class="option"><input type="radio" name="consultant_influence" value="significant">Significant influence – strongly shaped my decision</div>
          <div class="option"><input type="radio" name="consultant_influence" value="critical">Critical influence – I would not have purchased without them</div>
        </div>

        <div class="question-block">
          <span class="question">9. Did you feel the team followed up with you appropriately?</span>
          <div class="option"><input type="radio" name="follow_up" value="yes" required>Yes</div>
          <div class="option"><input type="radio" name="follow_up" value="sometimes">Sometimes</div>
          <div class="option"><input type="radio" name="follow_up" value="rarely">Rarely</div>
          <div class="option"><input type="radio" name="follow_up" value="never">Never</div>
        </div>

        <div class="question-block">
          <span class="question">
            10. Would beginning the process using a QR code (or app) so you don't need to repeat yourself improve your experience?
          </span>
          <div class="option"><input type="radio" name="qr_helpful" value="yes" required>Yes</div>
          <div class="option"><input type="radio" name="qr_helpful" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="qr_helpful" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">11. Would you prefer to browse before speaking with a consultant?</span>
          <div class="option"><input type="radio" name="prefer_browse" value="yes" required>Yes</div>
          <div class="option"><input type="radio" name="prefer_browse" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="prefer_browse" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">12. Would instant online test-drive booking improve your experience?</span>
          <div class="option"><input type="radio" name="online_booking" value="yes" required>Yes</div>
          <div class="option"><input type="radio" name="online_booking" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="online_booking" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">13. Would digitally entering your details be more convenient?</span>
          <div class="option"><input type="radio" name="digital_details" value="yes" required>Yes</div>
          <div class="option"><input type="radio" name="digital_details" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="digital_details" value="no">No</div>
        </div>

        <div class="btn-row">
          <button type="button" class="btn btn-back" onclick="prevPage()">Back</button>
          <button type="button" class="btn btn-next" onclick="nextPage()">Next</button>
        </div>
      </div>

      <!-- PAGE 3 -->
      <div class="page" data-page="3">
        <div class="section-label">Section 3 · Delivery Experience</div>

        <div class="question-block">
          <span class="question">14. How long did your consultant spend on delivery?</span>
          <div class="option"><input type="radio" name="delivery_time" value="0_10" required>0–10 minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="10_30">10–30 minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="30_60">30–60 minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="60_plus">60+ minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="none">No guided delivery</div>
        </div>

        <div class="question-block">
          <span class="question">15. Did this feel:</span>
          <div class="option"><input type="radio" name="delivery_length" value="right" required>About right</div>
          <div class="option"><input type="radio" name="delivery_length" value="short">Too short</div>
          <div class="option"><input type="radio" name="delivery_length" value="long">Too long</div>
          <div class="option"><input type="radio" name="delivery_length" value="unsure">Unsure</div>
        </div>

        <div class="question-block">
          <span class="question">16. What did you enjoy most?</span>
          <textarea name="delivery_enjoyed" required></textarea>
        </div>

        <div class="question-block">
          <span class="question">17. What could have improved your delivery?</span>
          <textarea name="delivery_improve" required></textarea>
        </div>

        <div class="btn-row">
          <button type="button" class="btn btn-back" onclick="prevPage()">Back</button>
          <button type="button" class="btn btn-next" onclick="nextPage()">Next</button>
        </div>
      </div>
      <!-- PAGE 4 -->
      <div class="page" data-page="4">
        <div class="section-label">Section 4 · Final Thoughts</div>

        <div class="question-block">
          <span class="question">
            18. When you are physically in the dealership, what would you consider the ideal total time for the in-store purchase process?
          </span>

          <div class="option"><input type="radio" name="ideal_purchase_time" value="under_30" required>Under 30 minutes</div>
          <div class="option"><input type="radio" name="ideal_purchase_time" value="30_60">30 minutes – 1 hour</div>
          <div class="option"><input type="radio" name="ideal_purchase_time" value="1_2">1 – 2 hours</div>
          <div class="option"><input type="radio" name="ideal_purchase_time" value="as_long_as_needed">As long as it takes, if the experience is good</div>
          <div class="option"><input type="radio" name="ideal_purchase_time" value="fully_online">Prefer a mostly or completely online (Amazon-style) experience</div>
        </div>

        <div class="question-block">
          <span class="question">19. If you could change one thing about the car-buying experience, what would it be?</span>
          <textarea name="change_one" required></textarea>
        </div>

        <div class="question-block">
          <span class="question">20. Would you consider a more digital dealership experience?</span>
          <div class="option"><input type="radio" name="future_digital" value="yes" required>Yes</div>
          <div class="option"><input type="radio" name="future_digital" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="future_digital" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">21. Which age bracket do you fall into?</span>
          <div class="option"><input type="radio" name="age" value="under_21" required>Under 21</div>
          <div class="option"><input type="radio" name="age" value="21_30">21–30</div>
          <div class="option"><input type="radio" name="age" value="31_40">31–40</div>
          <div class="option"><input type="radio" name="age" value="41_50">41–50</div>
          <div class="option"><input type="radio" name="age" value="51_60">51–60</div>
          <div class="option"><input type="radio" name="age" value="61_70">61–70</div>
          <div class="option"><input type="radio" name="age" value="70_plus">Over 70</div>
        </div>

        <!-- OPTIONAL EMAIL (NOT REQUIRED) -->
        <div class="question-block">
          <span class="question">Want to enter the draw for your next service on us?</span>
          <p class="helper-text" style="margin:6px 0 8px; font-size:13px; color:#6b7280;">
            Enter your email below to go into the draw. This is optional and your survey responses remain anonymous.
          </p>
          <input
            type="email"
            name="draw_email"
            placeholder="Email address (optional)"
            style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd;"
          />
        </div>

        <button type="submit" class="btn btn-submit">Submit</button>

        <div class="btn-row">
          <button type="button" class="btn btn-back" onclick="prevPage()">Back</button>
        </div>
      </div>
    </form>

    <div id="successScreen" class="success-screen">
      <h2>Thank you for your feedback!</h2>
      <p>We appreciate that you've taken the time to shape the Automotive Purchase landscape.</p>
    </div>
  </div>

  <!-- SCRIPT: Multi-page Logic + Supabase Submit -->
  <script>
    let currentPage = 1;
    const totalPages = 4;

    function updateProgress() {
      document.getElementById('progressBar').style.width =
        (currentPage / totalPages) * 100 + '%';
    }

    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelector(`[data-page="${page}"]`).classList.add('active');
      updateProgress();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg || "Please answer all required questions before continuing.";
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2800);
    }

    // ✅ Validate ONLY visible page inputs
    function validateCurrentPage() {
      const form = document.getElementById('surveyForm');
      const pageEl = document.querySelector(`.page[data-page="${currentPage}"]`);

      // Temporarily disable required for fields NOT on this page
      const requiredEls = Array.from(form.querySelectorAll('[required]'));
      const disabled = [];

      requiredEls.forEach(el => {
        if (!pageEl.contains(el)) {
          el.dataset.wasRequired = "1";
          el.required = false;
          disabled.push(el);
        }
      });

      const ok = form.reportValidity();

      // Restore required flags
      disabled.forEach(el => {
        if (el.dataset.wasRequired === "1") {
          el.required = true;
          delete el.dataset.wasRequired;
        }
      });

      return ok;
    }

    function nextPage() {
      if (!validateCurrentPage()) {
        showToast("Please answer all questions on this page before continuing.");
        return;
      }
      if (currentPage < totalPages) {
        currentPage++;
        showPage(currentPage);
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        showPage(currentPage);
      }
    }

    // Handle Submit + Insert into Supabase
    document.getElementById('surveyForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      // Validate final page requireds (and overall)
      if (!validateCurrentPage()) {
        showToast("Please answer all required questions before submitting.");
        return;
      }

      const formData = new FormData(this);
      const data = {};

      formData.forEach((value, key) => {
        data[key] = value;
      });

      const { error } = await supabase
        .from("customer_survey_responses")
        .insert([data]);

      if (error) {
        console.error("Supabase insert error:", error);
        alert("Something went wrong saving your survey.");
        return;
      }

      this.style.display = 'none';
      document.getElementById('successScreen').style.display = 'block';
      showToast("Thank you for your feedback! Your response has been submitted.");
    });

    updateProgress();
  </script>

</body>
</html>


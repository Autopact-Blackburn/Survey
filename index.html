<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Purchase Experience Survey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6fa;
      margin: 0;
      padding: 12px;
      color: #1d2634;
    }

    .container {
      max-width: 720px;
      margin: 18px auto;
      background: #ffffff;
      padding: 24px 22px 28px;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(15,23,42,0.10);
    }

    h1 {
      text-align: center;
      font-size: 22px;
      margin: 6px 0 8px;
      color: #111827;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 18px;
    }

    .progress-container {
      width: 100%;
      height: 10px;
      background: #dfe6ee;
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 22px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #005bea, #00c6fb);
      width: 0%;
      transition: width 0.35s ease;
    }

    .page { display: none; }
    .page.active { display: block; }

    .section-label {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .question-block {
      margin-bottom: 18px;
    }

    .question {
      display: block;
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #111827;
    }

    .option {
      margin: 5px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #374151;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      padding: 9px;
      border-radius: 8px;
      border: 1px solid #cbd3df;
      font-size: 14px;
      resize: vertical;
    }

    textarea:focus {
      outline: 2px solid #005bea33;
      outline-offset: 1px;
    }

    .btn-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 22px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 11px 22px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      font-weight: 600;
      transition: opacity 0.15s ease, transform 0.1s ease;
    }

    .btn:active {
      transform: translateY(1px);
      opacity: 0.75;
    }

    .btn-back {
      background: #e4e7ec;
      color: #111827;
    }

    .btn-next {
      background: #005bea;
      color: #ffffff;
    }

    .btn-submit {
      width: 100%;
      margin-top: 16px;
      background: #00b16a;
      color: #ffffff;
      padding: 13px;
    }

    .success-screen {
      text-align: center;
      padding: 28px 16px 6px;
      display: none;
    }

    .success-screen h2 {
      margin: 0 0 10px;
      font-size: 22px;
    }

    .success-screen p {
      font-size: 14px;
      color: #4b5563;
      margin-top: 0;
    }

    .toast {
      position: fixed;
      bottom: 22px;
      left: 50%;
      transform: translateX(-50%) translateY(12px);
      background: #111827;
      color: white;
      padding: 12px 16px;
      border-radius: 999px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.35s ease, transform 0.35s ease;
      font-size: 13px;
      max-width: 90%;
      text-align: center;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0px);
    }
  </style>
</head>

<body>

  <div id="toast" class="toast">
    Thank you for your feedback! We appreciate that you've taken the time to shape the Automotive Purchase landscape.
  </div>

  <div class="container">
    <h1>Customer Purchase Experience Survey</h1>
    <div class="subtitle">
      Your feedback helps shape the future car-buying experience.
    </div>

    <div class="progress-container">
      <div id="progressBar" class="progress-bar"></div>
    </div>

    <form id="surveyForm">

      <!-- PAGE 1 -->
      <div class="page active" data-page="1">

        <div class="section-label">Section 1 · Purchase Experience</div>

        <div class="question-block">
          <span class="question">1. When did you purchase your vehicle?</span>
          <div class="option"><input type="radio" name="purchase_time" value="past_month">Within the past month</div>
          <div class="option"><input type="radio" name="purchase_time" value="1_3">1–3 months ago</div>
          <div class="option"><input type="radio" name="purchase_time" value="3_12">3–12 months ago</div>
          <div class="option"><input type="radio" name="purchase_time" value="over_year">Over a year ago</div>
        </div>

        <div class="question-block">
          <span class="question">2. Rate your overall sales experience</span>
          <div class="option"><input type="radio" name="exp_rating" value="excellent">Excellent</div>
          <div class="option"><input type="radio" name="exp_rating" value="good">Good</div>
          <div class="option"><input type="radio" name="exp_rating" value="average">Average</div>
          <div class="option"><input type="radio" name="exp_rating" value="below_avg">Below average</div>
          <div class="option"><input type="radio" name="exp_rating" value="poor">Poor</div>
        </div>

        <div class="question-block">
          <span class="question">3. When you visited, how quickly were you greeted?</span>
          <div class="option"><input type="radio" name="greet_time" value="1_min">Within 1 minute</div>
          <div class="option"><input type="radio" name="greet_time" value="1_5">1–5 minutes</div>
          <div class="option"><input type="radio" name="greet_time" value="5_10">5–10 minutes</div>
          <div class="option"><input type="radio" name="greet_time" value="10_plus">More than 10 minutes</div>
          <div class="option"><input type="radio" name="greet_time" value="never">I was never greeted</div>
        </div>

        <div class="question-block">
          <span class="question">4. What parts felt smooth?</span>
          <textarea name="smooth"></textarea>
        </div>

        <div class="question-block">
          <span class="question">5. What parts felt frustrating?</span>
          <textarea name="frustrating"></textarea>
        </div>

        <div class="question-block">
          <span class="question">6. Compared to other dealers, what stood out?</span>
          <textarea name="other_dealers"></textarea>
        </div>

        <div class="btn-row">
          <span></span>
          <button type="button" class="btn btn-next" onclick="nextPage()">Next</button>
        </div>

      </div>

      <!-- PAGE 2 -->
      <div class="page" data-page="2">

        <div class="section-label">Section 2 · Consultant & Digital Experience</div>

        <div class="question-block">
          <span class="question">7. How comfortable were you with your consultant?</span>
          <div class="option"><input type="radio" name="comfort" value="very">Very comfortable</div>
          <div class="option"><input type="radio" name="comfort" value="somewhat">Somewhat comfortable</div>
          <div class="option"><input type="radio" name="comfort" value="neutral">Neutral</div>
          <div class="option"><input type="radio" name="comfort" value="dislike">Disliked</div>
          <div class="option"><input type="radio" name="comfort" value="na">N/A</div>
        </div>

        <div class="question-block">
          <span class="question">8. Did the team follow up appropriately?</span>
          <div class="option"><input type="radio" name="follow_up" value="yes">Yes</div>
          <div class="option"><input type="radio" name="follow_up" value="sometimes">Sometimes</div>
          <div class="option"><input type="radio" name="follow_up" value="rarely">Rarely</div>
          <div class="option"><input type="radio" name="follow_up" value="never">Never</div>
        </div>

        <div class="question-block">
          <span class="question">9. Would starting with a QR code (or app) help?</span>
          <div class="option"><input type="radio" name="qr_helpful" value="yes">Yes</div>
          <div class="option"><input type="radio" name="qr_helpful" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="qr_helpful" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">10. Would you prefer to browse before speaking?</span>
          <div class="option"><input type="radio" name="prefer_browse" value="yes">Yes</div>
          <div class="option"><input type="radio" name="prefer_browse" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="prefer_browse" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">11. Would instant online test-drive booking improve things?</span>
          <div class="option"><input type="radio" name="online_booking" value="yes">Yes</div>
          <div class="option"><input type="radio" name="online_booking" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="online_booking" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">12. Would digitally entering details be more convenient?</span>
          <div class="option"><input type="radio" name="digital_details" value="yes">Yes</div>
          <div class="option"><input type="radio" name="digital_details" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="digital_details" value="no">No</div>
        </div>

        <div class="btn-row">
          <button type="button" class="btn btn-back" onclick="prevPage()">Back</button>
          <button type="button" class="btn btn-next" onclick="nextPage()">Next</button>
        </div>

      </div>

      <!-- PAGE 3 -->
      <div class="page" data-page="3">

        <div class="section-label">Section 3 · Delivery Experience</div>

        <div class="question-block">
          <span class="question">13. How long did your delivery take?</span>
          <div class="option"><input type="radio" name="delivery_time" value="0_10">0–10 minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="10_30">10–30 minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="30_60">30–60 minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="60_plus">60+ minutes</div>
          <div class="option"><input type="radio" name="delivery_time" value="none">No guided delivery</div>
        </div>

        <div class="question-block">
          <span class="question">14. Did this feel:</span>
          <div class="option"><input type="radio" name="delivery_length" value="right">About right</div>
          <div class="option"><input type="radio" name="delivery_length" value="short">Too short</div>
          <div class="option"><input type="radio" name="delivery_length" value="long">Too long</div>
          <div class="option"><input type="radio" name="delivery_length" value="unsure">Unsure</div>
        </div>

        <div class="question-block">
          <span class="question">15. What did you enjoy most?</span>
          <textarea name="delivery_enjoyed"></textarea>
        </div>

        <div class="question-block">
          <span class="question">16. What could have improved your delivery?</span>
          <textarea name="delivery_improve"></textarea>
        </div>

        <div class="btn-row">
          <button type="button" class="btn btn-back" onclick="prevPage()">Back</button>
          <button type="button" class="btn btn-next" onclick="nextPage()">Next</button>
        </div>

      </div>

      <!-- PAGE 4 -->
      <div class="page" data-page="4">

        <div class="section-label">Section 4 · Final Thoughts</div>

        <div class="question-block">
          <span class="question">17. If you could change one thing, what would it be?</span>
          <textarea name="change_one"></textarea>
        </div>

        <div class="question-block">
          <span class="question">18. Would you consider a more digital dealership?</span>
          <div class="option"><input type="radio" name="future_digital" value="yes">Yes</div>
          <div class="option"><input type="radio" name="future_digital" value="maybe">Maybe</div>
          <div class="option"><input type="radio" name="future_digital" value="no">No</div>
        </div>

        <div class="question-block">
          <span class="question">19. What age bracket are you in?</span>
          <div class="option"><input type="radio" name="age" value="under_21">Under 21</div>
          <div class="option"><input type="radio" name="age" value="21_30">21–30</div>
          <div class="option"><input type="radio" name="age" value="31_40">31–40</div>
          <div class="option"><input type="radio" name="age" value="41_50">41–50</div>
          <div class="option"><input type="radio" name="age" value="51_60">51–60</div>
          <div class="option"><input type="radio" name="age" value="61_70">61–70</div>
          <div class="option"><input type="radio" name="age" value="70_plus">Over 70</div>
        </div>

        <button type="submit" class="btn btn-submit">Submit</button>

        <div class="btn-row">
          <button type="button" class="btn btn-back" onclick="prevPage()">Back</button>
        </div>

      </div>

    </form>

    <div id="successScreen" class="success-screen">
      <h2>Thank you for your feedback!</h2>
      <p>We appreciate that you've taken the time to shape the Automotive Purchase landscape.</p>
    </div>

  </div>

  <script>
    // --------------------
    // PAGE HANDLING
    // --------------------
    let currentPage = 1;
    const totalPages = 4;

    function updateProgress() {
      document.getElementById('progressBar').style.width =
        (currentPage / totalPages) * 100 + '%';
    }

    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelector(`[data-page="${page}"]`).classList.add('active');
      updateProgress();
    }

    function nextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        showPage(currentPage);
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        showPage(currentPage);
      }
    }

    updateProgress();

    function showToast() {
      const toast = document.getElementById('toast');
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2800);
    }

    // --------------------
    // SUPABASE CLIENT
    // --------------------
    const supabaseUrl = "YOUR_SUPABASE_URL";
    const supabaseAnonKey = "YOUR_ANON_KEY";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);

    // --------------------
    // FORM SUBMISSION
    // --------------------
    document.getElementById('surveyForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const dataObject = {};

      // Convert all fields to clean JSON object
      formData.forEach((value, key) => {
        dataObject[key] = value;
      });

      // Insert into Supabase
      const { data, error } = await supabaseClient
        .from("customer_survey_responses")
        .insert([dataObject]);

      if (error) {
        console.error(error);
        alert("Something went wrong submitting your survey.");
        return;
      }

      // Success screen
      this.style.display = 'none';
      document.getElementById('successScreen').style.display = 'block';
      showToast();
    });

  </script>

</body>
</html>
